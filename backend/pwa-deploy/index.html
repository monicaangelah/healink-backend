<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HeaLink Dashboard</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  /* Reset & base */
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #FFFCF8;
    color: #222;
  }
  * {
    box-sizing: border-box;
  }

  /* Container utama */
  #app {
    max-width: 1440px;
    margin: 20px auto;
    padding: 20px 30px;
    background: #FFFCF8;
    border-radius: 40px;
    box-shadow: 0 4px 90px rgba(0,0,0,0.06);
    display: flex;
    gap: 20px;
    min-height: 80vh;
  }

  /* Bagian kiri: grid kartu unit */
  #leftPanel {
    flex: 2;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* Header atas kiri */
  #headerOverview {
    background: white;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 3px 10px rgb(0 0 0 / 0.05);
  }
  #headerOverview h2 {
    margin: 0 0 8px 0;
  }
  #overviewStats {
    display: flex;
    gap: 15px;
    margin-top: 10px;
  }
  .statusBox {
    flex: 1;
    border-radius: 12px;
    padding: 12px 20px;
    font-weight: 700;
    font-size: 1.2rem;
    color: #000;
    text-align: center;
  }
  .statusGreen { background: #b8f1cd; }
  .statusYellow { background: #f8f0ad; }
  .statusRed { background: #f9c3b0; }

  /* Grid kartu unit */
  #unitGrid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(140px,1fr));
    gap: 20px;
  }

  /* Kartu unit */
  .unitCard {
    background: white;
    border-radius: 16px;
    padding: 16px 20px;
    box-shadow: 0 3px 10px rgb(0 0 0 / 0.05);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: relative;
    transition: transform 0.2s ease;
  }
  .unitCard:hover {
    transform: translateY(-5px);
  }
  .unitCard.active {
    box-shadow: 0 6px 15px rgb(0 123 255 / 0.5);
    border: 2px solid #007bff;
  }

  /* Label status di pojok */
  .unitStatus {
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 4px 8px;
    border-radius: 10px;
    color: #222;
  }
  .unitStatus.Green { background: #b8f1cd; }
  .unitStatus.Yellow { background: #f8f0ad; }
  .unitStatus.Red { background: #f9c3b0; }

  /* Info angka unit */
  .unitCode {
    font-weight: 900;
    font-size: 1.6rem;
    user-select: none;
  }
  .unitInfo {
    font-size: 0.9rem;
  }
  .unitInfo span {
    font-weight: 600;
  }

  /* Bagian kanan detail */
  #rightPanel {
    flex: 1.3;
    background: #2e2e2e;
    border-radius: 40px;
    padding: 30px 30px 40px;
    color: white;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  #detailHeader {
    font-weight: 900;
    font-size: 2.2rem;
    user-select: none;
  }

  #detailHistory {
    background: #4a4a4a;
    border-radius: 16px;
    padding: 12px 16px;
    max-height: 200px;
    overflow-y: auto;
    font-family: monospace;
    font-size: 0.9rem;
    white-space: pre-line;
    line-height: 1.4;
  }

  /* Grafik container */
  .chartCard {
    background: #fff;
    border-radius: 16px;
    padding: 14px 20px;
    color: #000;
  }

  .chartCard h3 {
    margin: 0 0 12px 0;
    font-weight: 700;
    text-align: center;
  }

  canvas {
    max-width: 100%;
    height: 100px;
  }
</style>
</head>
<body>

<div id="app">
  <!-- Kiri -->
  <div id="leftPanel">
    <div id="headerOverview">
      <h2>HeaLink Dashboard</h2>
      <div>Minggu, 18 Mei 2025</div>
      <ul>
        <li>Total Jumlah Pasien: <span id="totalPatients">10</span></li>
        <li>Status Triase</li>
      </ul>
      <div id="overviewStats">
        <div class="statusBox statusGreen">Hijau<br><span id="countGreen">8 orang</span></div>
        <div class="statusBox statusYellow">Kuning<br><span id="countYellow">1 orang</span></div>
        <div class="statusBox statusRed">Merah<br><span id="countRed">1 orang</span></div>
      </div>
    </div>

    <div id="unitGrid">
      <!-- Kartu unit akan dibuat secara dinamis -->
    </div>
  </div>

  <!-- Kanan -->
  <div id="rightPanel">
    <div id="detailHeader">Pilih unit</div>
    <div id="detailHistory">Tidak ada data</div>

    <div class="chartCard">
      <h3>Suhu Tubuh</h3>
      <canvas id="chartTemp"></canvas>
    </div>
    <div class="chartCard">
      <h3>Saturasi Oksigen</h3>
      <canvas id="chartSpo2"></canvas>
    </div>
    <div class="chartCard">
      <h3>Detak Jantung/menit</h3>
      <canvas id="chartBpm"></canvas>
    </div>
  </div>
</div>

<script>
  // Dummy data awal pasien
  const units = [
    { code: "1A", status: "Yellow", temperature: 80, spo2: 80.2, bpm: 80 },
    { code: "2A", status: "Green", temperature: 80, spo2: 80.2, bpm: 80 },
    { code: "3A", status: "Red", temperature: 80, spo2: 80.2, bpm: 80 },
    { code: "4A", status: "Green", temperature: 80, spo2: 80.2, bpm: 80 },
    { code: "5A", status: "Green", temperature: 80, spo2: 80.2, bpm: 80 },
    { code: "6A", status: "Green", temperature: 80, spo2: 80.2, bpm: 80 },
    { code: "7A", status: "Green", temperature: 80, spo2: 80.2, bpm: 80 },
    { code: "8A", status: "Green", temperature: 80, spo2: 80.2, bpm: 80 },
    { code: "9A", status: "Green", temperature: 80, spo2: 80.2, bpm: 80 },
  ];

  const unitGrid = document.getElementById('unitGrid');
  const detailHeader = document.getElementById('detailHeader');
  const detailHistory = document.getElementById('detailHistory');

  // Buat kartu unit di grid
  function createUnitCards() {
    unitGrid.innerHTML = '';
    units.forEach(unit => {
      const card = document.createElement('div');
      card.classList.add('unitCard');
      card.dataset.code = unit.code;
      card.dataset.status = unit.status;

      card.innerHTML = `
        <div class="unitCode">${unit.code}</div>
        <div class="unitStatus ${unit.status}">${unit.status}</div>
        <div class="unitInfo"><span>Suhu</span> ${unit.temperature} °C</div>
        <div class="unitInfo"><span>SpO2</span> ${unit.spo2}</div>
        <div class="unitInfo"><span>BPM</span> ${unit.bpm}</div>
      `;

      card.addEventListener('click', () => selectUnit(unit.code));
      unitGrid.appendChild(card);
    });
  }

  // Aktifkan kartu yang dipilih & update detail kanan
  let selectedUnitCode = null;

  function selectUnit(code) {
    selectedUnitCode = code;
    detailHeader.textContent = code;

    // Tandai kartu aktif
    document.querySelectorAll('.unitCard').forEach(card => {
      card.classList.toggle('active', card.dataset.code === code);
    });

    // Kosongkan histori dan data grafik
    detailHistory.textContent = "Loading data...";
    clearChartData();

    // Inisialisasi data histori simulasi (nanti data asli dari websocket)
    loadHistoryData(code);
  }

  // Data histori simulasi (isi akan update realtime dari websocket)
  let historyData = [];

  function loadHistoryData(code) {
    // Reset data histori
    historyData = [];

    // Simulasi load histori data
    for(let i=0; i<8; i++) {
      const t = new Date(Date.now() - i*60000);
      historyData.push({
        temperature: 35 + Math.random()*5,
        bpm: 60 + Math.floor(Math.random()*20),
        spo2: 88 + Math.floor(Math.random()*10),
        timestamp: t.toISOString()
      });
    }

    updateHistoryDisplay();
    updateChartData();
  }

  // Update teks histori di panel kanan
  function updateHistoryDisplay() {
    if(historyData.length === 0) {
      detailHistory.textContent = "Tidak ada data";
      return;
    }

    const lines = historyData.map(h => {
      return `Suhu : ${h.temperature.toFixed(1)} °C, BPM : ${h.bpm}, SpO2 : ${h.spo2}, Time : ${new Date(h.timestamp).toLocaleString()}`;
    });
    detailHistory.textContent = lines.join('\n');
  }

  // Setup Chart.js grafik
  const ctxTemp = document.getElementById('chartTemp').getContext('2d');
  const ctxSpo2 = document.getElementById('chartSpo2').getContext('2d');
  const ctxBpm = document.getElementById('chartBpm').getContext('2d');

  const chartTemp = new Chart(ctxTemp, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'Suhu', data: [], borderColor: '#f39c12', fill: true, backgroundColor: 'rgba(243,156,18,0.2)' }] },
    options: {
      scales: { y: { min: 33, max: 42 }, x: { display: false } },
      plugins: { legend: { display: false } },
      responsive: true,
      animation: false,
      elements: { point: { radius: 0 } }
    }
  });
  const chartSpo2 = new Chart(ctxSpo2, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'SpO2', data: [], borderColor: '#e74c3c', fill: true, backgroundColor: 'rgba(231,76,60,0.2)' }] },
    options: {
      scales: { y: { min: 80, max: 100 }, x: { display: false } },
      plugins: { legend: { display: false } },
      responsive: true,
      animation: false,
      elements: { point: { radius: 0 } }
    }
  });
  const chartBpm = new Chart(ctxBpm, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'BPM', data: [], borderColor: '#3498db', fill: true, backgroundColor: 'rgba(52,152,219,0.2)' }] },
    options: {
      scales: { y: { min: 30, max: 130 }, x: { display: false } },
      plugins: { legend: { display: false } },
      responsive: true,
      animation: false,
      elements: { point: { radius: 0 } }
    }
  });

  // Update grafik dengan data histori
  function updateChartData() {
    if(historyData.length === 0) return;

    const labels = historyData.map(h => new Date(h.timestamp).toLocaleTimeString());

    chartTemp.data.labels = labels;
    chartSpo2.data.labels = labels;
    chartBpm.data.labels = labels;

    chartTemp.data.datasets[0].data = historyData.map(h => h.temperature);
    chartSpo2.data.datasets[0].data = historyData.map(h => h.spo2);
    chartBpm.data.datasets[0].data = historyData.map(h => h.bpm);

    chartTemp.update();
    chartSpo2.update();
    chartBpm.update();
  }

  // Bersihkan data grafik
  function clearChartData() {
    chartTemp.data.labels = [];
    chartSpo2.data.labels = [];
    chartBpm.data.labels = [];

    chartTemp.data.datasets[0].data = [];
    chartSpo2.data.datasets[0].data = [];
    chartBpm.data.datasets[0].data = [];

    chartTemp.update();
    chartSpo2.update();
    chartBpm.update();
  }

  // Pilih unit default
  createUnitCards();
  selectUnit(units[0].code);

  // --- Bagian WebSocket simulasi (ganti dengan endpoint asli kamu) ---
  // Contoh simulasi update data realtime tiap 5 detik
  setInterval(() => {
    if(!selectedUnitCode) return;

    // Simulasi data baru masuk
    const now = new Date();
    const newData = {
      temperature: 35 + Math.random()*5,
      bpm: 60 + Math.floor(Math.random()*20),
      spo2: 88 + Math.floor(Math.random()*10),
      timestamp: now.toISOString()
    };

    // Tambah ke histori jika unit yang sama dipilih
    if(selectedUnitCode) {
      historyData.unshift(newData);
      if(historyData.length > 10) historyData.pop();
      updateHistoryDisplay();
      updateChartData();
    }
  }, 5000);

</script>

</body>
</html>
