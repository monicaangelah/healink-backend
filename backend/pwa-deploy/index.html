<!DOCTYPE html>
<html lang="id">
<head>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#007bff" />
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HeaLink Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #FFFCF8;
    color: #222;
  }
  * {
    box-sizing: border-box;
  }
  #app {
    max-width: 1440px;
    margin: 20px auto;
    padding: 20px 30px;
    background: #FFFCF8;
    border-radius: 40px;
    box-shadow: 0 4px 90px rgba(0,0,0,0.06);
    display: flex;
    gap: 20px;
    min-height: 80vh;
  }
  #leftPanel {
    flex: 2;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  #headerOverview {
    background: white;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 3px 10px rgb(0 0 0 / 0.05);
    position: relative;
  }
  #headerOverview h2 {
    margin: 0 0 8px 0;
    font-weight: 700;
    font-size: 1.8rem;
  }
  #clock {
    position: absolute;
    top: 20px;
    right: 20px;
    font-weight: 700;
    font-size: 1.2rem;
    color: #444;
    user-select: none;
  }
  #overviewStats {
    display: flex;
    gap: 15px;
    margin-top: 10px;
  }
  .statusBox {
    flex: 1;
    border-radius: 12px;
    padding: 12px 20px;
    font-weight: 700;
    font-size: 1.2rem;
    color: #000;
    text-align: center;
  }
  .statusGreen { background: #b8f1cd; }
  .statusYellow { background: #f8f0ad; }
  .statusRed { background: #f9c3b0; }

  #unitGrid {
    display: grid;
    grid-template-columns: 180px;
    gap: 20px;
  }

  .unitCard {
    background: white;
    border-radius: 16px;
    padding: 24px 28px;
    box-shadow: 0 3px 10px rgb(0 0 0 / 0.05);
    cursor: pointer;
    position: relative;
    transition: transform 0.2s ease;
    user-select: none;
  }
  .unitCard:hover {
    transform: translateY(-5px);
  }
  .unitCard.disabled {
    background: #fff;
    color: #3b3838;
    cursor: default;
    box-shadow: none;
  }
  .unitStatus {
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 4px 8px;
    border-radius: 10px;
    color: #222;
  }
  .unitStatus.Green { background: #b8f1cd; }
  .unitStatus.Yellow { background: #f8f0ad; }
  .unitStatus.Red { background: #f9c3b0; }
  .unitCode {
    font-weight: 900;
    font-size: 1.6rem;
    margin-bottom: 12px;
  }
  .unitInfo {
    font-size: 1.1rem;
    line-height: 1.4;
  }
  .unitInfo span {
    font-weight: 600;
  }

  #rightPanel {
    flex: 1.3;
    background: #2e2e2e;
    border-radius: 40px;
    padding: 24px 20px 30px;
    color: white;
    display: flex;
    flex-direction: column;
    gap: 18px;
  }

  #detailHeader {
    font-weight: 900;
    font-size: 2.2rem;
    user-select: none;
  }

  #detailHistory {
    background: #4a4a4a;
    border-radius: 16px;
    padding: 12px 16px;
    max-height: 200px;
    overflow-y: auto;
    font-family: monospace;
    font-size: 0.9rem;
    white-space: pre-line;
    line-height: 1.4;
  }

  .chartCard {
    background: #fff;
    border-radius: 16px;
    padding: 10px 12px;
    color: #000;
  }

  .chartCard h3 {
    margin: 0 0 8px 0;
    font-weight: 700;
    text-align: center;
    font-size: 1.1rem;
  }

  canvas {
    max-width: 100%;
    height: 80px !important;
  }
</style>
</head>
<body>

<div id="app">
  <div id="leftPanel">
    <div id="headerOverview">
      <h2>Dashboard HeaLink</h2>
      <div id="clock">--:--:--</div>
      <ul>
        <li>Total Jumlah Pasien: <span id="totalPatients">1</span></li>
        <li>Status Triase</li>
      </ul>
      <div id="overviewStats">
        <div class="statusBox statusGreen">Hijau<br><span id="countGreen">0 orang</span></div>
        <div class="statusBox statusYellow">Kuning<br><span id="countYellow">0 orang</span></div>
        <div class="statusBox statusRed">Merah<br><span id="countRed">0 orang</span></div>
      </div>
    </div>

    <div id="unitGrid">
      <!-- Hanya satu kotak -->
      <div class="unitCard disabled" id="unit1A">
        <div class="unitCode">1A</div>
        <div class="unitStatus" id="unit1AStatus">Tidak Ada</div>
        <div class="unitInfo"><span>Suhu</span> - °C</div>
        <div class="unitInfo"><span>SpO2</span> -</div>
        <div class="unitInfo"><span>BPM</span> -</div>
      </div>
    </div>
  </div>

  <div id="rightPanel">
    <div id="detailHeader">Pilih unit</div>
    <div id="detailHistory">Tidak ada data</div>

    <div class="chartCard">
      <h3>Suhu Tubuh</h3>
      <canvas id="chartTemp"></canvas>
    </div>
    <div class="chartCard">
      <h3>Saturasi Oksigen</h3>
      <canvas id="chartSpo2"></canvas>
    </div>
    <div class="chartCard">
      <h3>Detak Jantung/menit</h3>
      <canvas id="chartBpm"></canvas>
    </div>
  </div>
</div>

<script>
  // Update jam realtime
  function updateClock() {
    const clockEl = document.getElementById('clock');
    const now = new Date();
    const h = now.getHours().toString().padStart(2,'0');
    const m = now.getMinutes().toString().padStart(2,'0');
    const s = now.getSeconds().toString().padStart(2,'0');
    clockEl.textContent = `${h}:${m}:${s}`;
  }
  setInterval(updateClock, 1000);
  updateClock();

  const unit1A = document.getElementById('unit1A');
  const unit1AStatusLabel = document.getElementById('unit1AStatus');
  const detailHeader = document.getElementById('detailHeader');
  const detailHistory = document.getElementById('detailHistory');

  // Chart setup
  const ctxTemp = document.getElementById('chartTemp').getContext('2d');
  const ctxSpo2 = document.getElementById('chartSpo2').getContext('2d');
  const ctxBpm = document.getElementById('chartBpm').getContext('2d');

  const chartTemp = new Chart(ctxTemp, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'Suhu', data: [], borderColor: '#f39c12', fill: true, backgroundColor: 'rgba(243,156,18,0.2)' }] },
    options: {
      scales: { y: { min: 33, max: 42 }, x: { display: false } },
      plugins: { legend: { display: false } },
      responsive: true,
      animation: false,
      elements: { point: { radius: 0 } }
    }
  });
  const chartSpo2 = new Chart(ctxSpo2, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'SpO2', data: [], borderColor: '#e74c3c', fill: true, backgroundColor: 'rgba(231,76,60,0.2)' }] },
    options: {
      scales: { y: { min: 80, max: 100 }, x: { display: false } },
      plugins: { legend: { display: false } },
      responsive: true,
      animation: false,
      elements: { point: { radius: 0 } }
    }
  });
  const chartBpm = new Chart(ctxBpm, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'BPM', data: [], borderColor: '#3498db', fill: true, backgroundColor: 'rgba(52,152,219,0.2)' }] },
    options: {
      scales: { y: { min: 30, max: 130 }, x: { display: false } },
      plugins: { legend: { display: false } },
      responsive: true,
      animation: false,
      elements: { point: { radius: 0 } }
    }
  });

  // Data histori untuk 1A
  let historyData = [];

  // Fungsi update warna status kotak 1A berdasar sensor
  function updateStatusColor(suhu, bpm, spo2) {
    let status = 'Green';

    if ((bpm < 50) || (spo2 < 85) || (suhu < 35) || (suhu > 40)) {
      status = 'Red';
    } else if ((bpm >= 50 && bpm <= 55) || (suhu === 34 || suhu === 38 || suhu === 39) || (spo2 > 85 && spo2 < 88)) {
      status = 'Yellow';
    } else {
      status = 'Green';
    }

    unit1A.classList.remove('Green', 'Yellow', 'Red');
    unit1A.classList.add(status);
    unit1A.style.backgroundColor = status === 'Green' ? '#b8f1cd' : status === 'Yellow' ? '#f8f0ad' : '#f9c3b0';

    unit1AStatusLabel.textContent = status;
    unit1AStatusLabel.className = 'unitStatus ' + status;

    // Update jumlah pasien di dashboard
    document.getElementById('totalPatients').textContent = 1;
    document.getElementById('countGreen').textContent = status === 'Green' ? '1 orang' : '0 orang';
    document.getElementById('countYellow').textContent = status === 'Yellow' ? '1 orang' : '0 orang';
    document.getElementById('countRed').textContent = status === 'Red' ? '1 orang' : '0 orang';
  }

  // Update histori text
  function updateHistoryDisplay() {
    if(historyData.length === 0) {
      detailHistory.textContent = "Tidak ada data";
      return;
    }
    const lines = historyData.map(h => {
      return `Suhu : ${h.temperature.toFixed(1)} °C, BPM : ${h.bpm}, SpO2 : ${h.spo2}, Time : ${new Date(h.timestamp).toLocaleString()}`;
    });
    detailHistory.textContent = lines.join('\n');
  }

  // Update grafik dengan data histori
  function updateChartData() {
    if(historyData.length === 0) return;

    const labels = historyData.map(h => new Date(h.timestamp).toLocaleTimeString());

    chartTemp.data.labels = labels;
    chartSpo2.data.labels = labels;
    chartBpm.data.labels = labels;

    chartTemp.data.datasets[0].data = historyData.map(h => h.temperature);
    chartSpo2.data.datasets[0].data = historyData.map(h => h.spo2);
    chartBpm.data.datasets[0].data = historyData.map(h => h.bpm);

    chartTemp.update();
    chartSpo2.update();
    chartBpm.update();
  }

  // Bersihkan data grafik
  function clearChartData() {
    chartTemp.data.labels = [];
    chartSpo2.data.labels = [];
    chartBpm.data.labels = [];

    chartTemp.data.datasets[0].data = [];
    chartSpo2.data.datasets[0].data = [];
    chartBpm.data.datasets[0].data = [];

    chartTemp.update();
    chartSpo2.update();
    chartBpm.update();
  }

  // Saat klik kotak 1A, aktifkan dan update detail
  unit1A.addEventListener('click', () => {
    detailHeader.textContent = '1A';
  });

  // Simulasi koneksi WebSocket data realtime, ganti sesuai backend kamu
  // Contoh simulasi update data tiap 5 detik
  setInterval(() => {
    const now = new Date();
    // Simulasi data sensor random normal
    const newData = {
      temperature: 35 + Math.random() * 6,  // 35-41 derajat
      bpm: 45 + Math.floor(Math.random() * 90), // 45-135 bpm
      spo2: 80 + Math.floor(Math.random() * 20), // 80-100%
      timestamp: now.toISOString()
    };

    // Push ke histori, max 10 data
    historyData.unshift(newData);
    if(historyData.length > 10) historyData.pop();

    // Update tampilan
    unit1A.querySelector('.unitInfo:nth-child(3)').textContent = `Suhu ${newData.temperature.toFixed(1)} °C`;
    unit1A.querySelector('.unitInfo:nth-child(4)').textContent = `SpO2 ${newData.spo2.toFixed(1)}`;
    unit1A.querySelector('.unitInfo:nth-child(5)').textContent = `BPM ${newData.bpm}`;

    updateStatusColor(newData.temperature, newData.bpm, newData.spo2);
    updateHistoryDisplay();
    updateChartData();

    // Set detail header otomatis ke 1A kalau belum pilih
    if(detailHeader.textContent === 'Pilih unit') {
      detailHeader.textContent = '1A';
    }
  }, 5000);

</script>

</body>
</html>
