<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard IoT</title>
<style>
  /* Container utama responsive */
  #app {
    box-sizing: border-box;
    max-width: 1440px;
    min-width: 320px;
    width: 90vw;
    height: 90vh;
    margin: 20px auto;
    padding: 20px;
    background: #FFFCF8;
    border: 1px solid #E8E7E7;
    box-shadow: 0 4px 90px rgba(0,0,0,0.06);
    border-radius: 40px;

    display: flex;
    gap: 20px;
  }

  /* Sidebar kiri: daftar unit */
  #unitList {
    flex: 1 1 200px; /* minimal 200px */
    display: flex;
    flex-direction: column;
    gap: 10px;
    overflow-y: auto;
  }

  .unitBtn {
    padding: 15px;
    background: white;
    border: 1px solid #ccc;
    border-radius: 12px;
    cursor: pointer;
    text-align: center;
    font-weight: bold;
    user-select: none;
    transition: background-color 0.3s, border-color 0.3s;
  }

  .unitBtn:hover {
    background-color: #f0f0f0;
  }

  .unitBtn.active {
    background-color: #007bff;
    color: white;
    border-color: #0056b3;
  }

  /* Konten kanan: info sensor dan grafik */
  #unitDetail {
    flex: 3 1 600px;
    background: white;
    border-radius: 20px;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  #sensorInfo {
    font-size: 18px;
    font-weight: bold;
  }

  #chartContainer {
    flex-grow: 1;
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 10px;
    /* nanti canvas grafik ditempatkan di sini */
  }
</style>
</head>
<body>
  <div id="app">
    <div id="unitList">
      <div class="unitBtn active" data-unit="A1">A1</div>
      <div class="unitBtn" data-unit="A2">A2</div>
      <div class="unitBtn" data-unit="A3">A3</div>
      <div class="unitBtn" data-unit="A4">A4</div>
      <!-- tambah unit lain sesuai kebutuhan -->
    </div>
    <div id="unitDetail">
      <div id="sensorInfo">Pilih unit untuk melihat data sensor</div>
      <div id="chartContainer">
        <!-- grafik akan dirender di sini -->
        <canvas id="sensorChart"></canvas>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const unitButtons = document.querySelectorAll('.unitBtn');
    const sensorInfo = document.getElementById('sensorInfo');
    const ctx = document.getElementById('sensorChart').getContext('2d');

    let currentUnit = 'A1';

    // Contoh data sensor simulasi untuk tiap unit (real nanti ambil via WebSocket/MQTT)
    const sensorData = {
      'A1': { bpm: 75, temp: 36.7, spo2: 98 },
      'A2': { bpm: 60, temp: 37.2, spo2: 96 },
      'A3': { bpm: 80, temp: 36.1, spo2: 95 },
      'A4': { bpm: 70, temp: 36.8, spo2: 99 }
    };

    // Contoh data grafik awal (dummy)
    let chartData = {
      labels: [],
      datasets: [{
        label: 'BPM',
        data: [],
        borderColor: 'rgb(255, 99, 132)',
        fill: false,
      }, {
        label: 'Temperature (°C)',
        data: [],
        borderColor: 'rgb(54, 162, 235)',
        fill: false,
      }, {
        label: 'SpO2 (%)',
        data: [],
        borderColor: 'rgb(75, 192, 192)',
        fill: false,
      }]
    };

    let sensorChart = new Chart(ctx, {
      type: 'line',
      data: chartData,
      options: {
        responsive: true,
        animation: false,
        scales: {
          x: {
            type: 'realtime', // pakai plugin realtime jika ingin update otomatis
            realtime: {
              delay: 2000,
              onRefresh(chart) {
                if (!currentUnit) return;
                // Simulasi data sensor update setiap detik
                const now = Date.now();
                chart.data.labels.push(now);
                const s = sensorData[currentUnit];
                chart.data.datasets[0].data.push({x: now, y: s.bpm});
                chart.data.datasets[1].data.push({x: now, y: s.temp});
                chart.data.datasets[2].data.push({x: now, y: s.spo2});

                // Batasi data max 30 point
                chart.data.labels = chart.data.labels.slice(-30);
                chart.data.datasets.forEach(ds => ds.data = ds.data.slice(-30));
              }
            }
          },
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // Fungsi update info sensor di samping kanan
    function updateSensorInfo(unit) {
      if (!sensorData[unit]) {
        sensorInfo.textContent = 'Data tidak tersedia untuk unit ' + unit;
        return;
      }
      const s = sensorData[unit];
      sensorInfo.textContent = `Unit ${unit} — BPM: ${s.bpm}, Temperature: ${s.temp} °C, SpO2: ${s.spo2}%`;
    }

    // Saat klik tombol unit
    unitButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        unitButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentUnit = btn.dataset.unit;
        updateSensorInfo(currentUnit);

        // Reset grafik data untuk unit baru
        sensorChart.data.labels = [];
        sensorChart.data.datasets.forEach(ds => ds.data = []);
        sensorChart.update();
      });
    });

    // Inisialisasi tampilkan data unit A1
    updateSensorInfo(currentUnit);
  </script>
</body>
</html>
